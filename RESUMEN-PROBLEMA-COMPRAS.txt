â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸš¨ PROBLEMA: COMPRAS NO APARECEN EN HISTORIAL                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“‹ SITUACIÃ“N ACTUAL:
  âœ… Las compras se realizan en Mercado Pago (tarjetas TEST funcionan)
  âœ… No hay errores en la consola durante el checkout
  âŒ Las Ã³rdenes NO aparecen en /admin/sales-history
  âŒ El historial de ventas estÃ¡ vacÃ­o

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” CAUSA PROBABLE:

El flujo deberÃ­a ser:
  1. Usuario hace checkout
  2. Se crea orden TEMPORAL (en memory)
  3. Se envÃ­a a Mercado Pago
  4. Usuario paga â†’ MP aprueba pago
  5. MP ENVÃA WEBHOOK a tu servidor (a travÃ©s de ngrok)
  6. Webhook CREA orden REAL en BD
  7. Orden aparece en historial

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  EL WEBHOOK PROBABLEMENTE NO SE ENVÃA O NO SE PROCESA CORRECTAMENTE          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ DIAGNÃ“STICO RÃPIDO (5 MINUTOS):

1. Abre ngrok dashboard: http://localhost:4040
   â†“
   Â¿Ves "Online" con URL https://...ngrok-free.app?
   
   SI NO:
      Terminal: ngrok http 3000
      â†“
      Espera a ver "Forwarding https://..."

2. Copia la URL de ngrok (ejemplo: https://f9c5a233dcaa.ngrok-free.app)

3. Ve a MP Dashboard: https://www.mercadopago.com.ar/developers/panel
   â†“
   IntegraciÃ³n â†’ Webhooks
   â†“
   URL debe ser: https://tu-url-ngrok/api/mercadopago/webhook
   â†“
   Â¿EstÃ¡ guardada y en VERDE con checkmark?
   
   SI NO:
      Actualiza la URL, guarda y confirma

4. Haz un checkout de prueba en http://localhost:3000/carrito

5. Mientras se procesa, abre ngrok dashboard: http://localhost:4040
   â†“
   Â¿Ves POST /api/mercadopago/webhook con status 200?
   
   SI:     â†’ El webhook llega correctamente
            â†’ Problema es al procesar (revisa consola npm run dev)
   
   SI NO:  â†’ El webhook NO llega
            â†’ URL en MP Dashboard estÃ¡ mal
            â†’ Revisa que ngrok estÃ© activo y URL sea actual

6. Ve a Supabase â†’ tabla "orders"
   â†“
   Â¿Hay una fila nueva con payment_status = "approved"?
   
   SI:     â†’ Orden se creÃ³ correctamente
            â†’ Problema es en frontend (revisa consola navegador F12)
   
   SI NO:  â†’ Webhook no creÃ³ la orden
            â†’ Revisa error en consola npm run dev

7. Ve a http://localhost:3000/admin/sales-history
   â†“
   Â¿Aparece la orden?
   
   SI:     â†’ âœ… TODO FUNCIONA
   
   SI NO:  â†’ Revisa consola navegador F12 por errores

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ› ï¸ HERRAMIENTAS DISPONIBLES:

Ejecuta en terminal:
  cd Fronted
  npm run debug:webhook
  
  Esto automÃ¡ticamente verificarÃ¡:
    âœ“ Servidor estÃ¡ corriendo
    âœ“ ngrok estÃ¡ activo
    âœ“ Ã“rdenes en BD
    âœ“ Activity logs (datos temporales y webhooks)
    âœ“ Recomendaciones especÃ­ficas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š DOCUMENTACIÃ“N COMPLETA:

- VERIFICAR-COMPRAS-AHORA.md (âš¡ RÃPIDO - 5 min)
  â†’ Paso a paso para verificar que todo funcione
  
- DEBUGGING-COMPRAS-NO-APARECEN.md (ğŸ“– DETALLADO - 30 min)
  â†’ ExplicaciÃ³n completa del flujo, puntos de fallo, soluciones

- scripts/debug-webhook-flow.js
  â†’ Script automÃ¡tico para diagnosticar problema
  â†’ Ejecutar: npm run debug:webhook

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… CHECKLIST - PROBLEMA MÃS PROBABLE:

[ ] ngrok dashboard muestra URL activa (https://...ngrok-free.app)
[ ] MP Dashboard > Webhooks > URL estÃ¡ correcta
[ ] MP Dashboard muestra URL en VERDE con checkmark
[ ] Hiciste al menos un checkout
[ ] ngrok dashboard muestra POST /api/mercadopago/webhook (status 200)
[ ] Consola npm run dev muestra "âœ… Orden real creada"
[ ] Supabase tabla orders tiene fila nueva
[ ] /admin/sales-history muestra la orden

Si todas estÃ¡n âœ…: TODO FUNCIONA

Si alguna no estÃ¡ âœ…: ESE ES EL PUNTO DE FALLO

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ†˜ AYUDA RÃPIDA:

Problema: "No veo webhook en ngrok dashboard"
SoluciÃ³n:
  1. Verifica ngrok estÃ© activo (http://localhost:4040 dice "Online")
  2. Verifica URL en MP Dashboard sea correcta y actual
  3. Si ngrok fue reiniciado, la URL cambiÃ³ - actualiza en MP Dashboard
  4. Intenta compra nuevamente

Problema: "Veo webhook (200) pero orden no en BD"
SoluciÃ³n:
  1. Revisa consola npm run dev por error de webhook
  2. Verifica que haya datos temporales en activity_logs
  3. Si error dice "Datos temporales no encontrados": nunca hiciste checkout real

Problema: "Orden estÃ¡ en BD pero no en historial admin"
SoluciÃ³n:
  1. Verifica que estÃ©s logueado como admin
  2. Presiona F5 para refrescar
  3. Abre consola (F12) y revisa si hay errores

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ INFORMACIÃ“N PARA COMPARTIR SI NECESITAS AYUDA:

1. Salida de: npm run debug:webhook
2. Screenshot de ngrok dashboard (mostrando URL)
3. Screenshot de MP Dashboard > Webhooks (mostrando URL configurada)
4. Ãšltimo error de la consola npm run dev
5. Screenshot de Supabase tabla orders (Â¿tiene filas?)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ãšltima actualizaciÃ³n: 03 Noviembre 2025


